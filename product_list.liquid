<style>
.whata-star {
    position: relative;
    display: inline-block;
    font-size: 20px; /* Adjust as needed */
    line-height: 1;
}

.whata-star-filled {
    color: gold; /* Or any color you prefer for filled stars */
}

.whata-star-empty {
    color: #ccc; /* Or any color you prefer for empty stars */
}

.whata-star-partial {
    color: gold; /* Same as filled star color */
    position: absolute;
    top: 0;
    left: 0;
}

.whata-star-container {
    display: flex;
    flex-direction: row;
    gap: 5px;
    align-items: center;
}
</style>

<script>
window.WHATA_PLATFORM_ID = '51253837997';

(function () {
    function createRatingWidget(containerId, apiUrl) {
        const ratingWidget = document.getElementById(containerId);

        async function fetchRating() {
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();
                renderStars(data.rating, data.count);
            } catch (error) {
                console.error('Error fetching rating:', error);
            }
        }

        function renderStars(rating, rCount) {
            ratingWidget.innerHTML = '';

            const fullStars = Math.floor(rating);
            const decimalPart = rating - fullStars;

            for (let i = 1; i <= 5; i++) {
                const star = document.createElement('span');
                star.className = 'whata-star';

                if (i <= fullStars) {
                    star.innerHTML = '★';
                    star.classList.add('whata-star-filled');
                } else if (i === fullStars + 1 && decimalPart > 0) {
                    const partialStar = document.createElement('span');
                    partialStar.className = 'whata-star-partial';
                    partialStar.innerHTML = '★';
                    partialStar.style.width = `${decimalPart * 100}%`;

                    const emptyStar = document.createElement('span');
                    emptyStar.className = 'whata-star-empty';
                    emptyStar.innerHTML = '☆';

                    star.appendChild(partialStar);
                    star.appendChild(emptyStar);
                } else {
                    star.innerHTML = '☆';
                    star.classList.add('whata-star-empty');
                }

                ratingWidget.appendChild(star);
            }

            const count = document.createElement('span');
            count.style.marginLeft = '5px';
            count.innerHTML = `${rating.toFixed(1)} (${rCount})`;
            ratingWidget.appendChild(count);
        }

        fetchRating();
    }

    const uid = `whata-star-${new Date().getTime()}`;

    document.write(`<div id="${uid}" class="whata-star-container"></div>`);
    createRatingWidget(uid, 'https://apiv2.whatacart.ai/v1/stores/' + window.WHATA_PLATFORM_ID + '/pub/reviews/{{  card_product.id }}');
})();
</script>
